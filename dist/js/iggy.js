/*
 * IGGY 0.2.7 ( 2017-02-10 )
 * http://mpneuried.github.io/iggy/
 *
 * Released under the MIT license
 * https://github.com/mpneuried/iggy/blob/master/LICENSE
*/
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.IGGY=a()}}(function(){var a;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=function(a,b){return function(){return a.apply(b,arguments)}},q=function(a,b){function c(){this.constructor=a}for(var d in b)r.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},r={}.hasOwnProperty;n=a("./views/main"),d=a("./models/facets"),k=a("./models/facet_string"),e=a("./models/facet_array"),j=a("./models/facet_select"),h=a("./models/facet_number"),i=a("./models/facet_range"),f=a("./models/facet_daterange"),g=a("./models/facet_event"),o=a("./models/results"),m=1,l=function(a){function b(a,b,c){null==b&&(b=[]),null==c&&(c={}),this._initErrors=p(this._initErrors,this),this.triggerEvent=p(this.triggerEvent,this),this.triggerChange=p(this.triggerChange,this),this.getQuery=p(this.getQuery,this),this._filterEmpty=p(this._filterEmpty,this),this._error=p(this._error,this),this.addFacet=p(this.addFacet,this),this._prepareFacets=p(this._prepareFacets,this),this._prepareEl=p(this._prepareEl,this),_.extend(this,Backbone.Events),this._initErrors(),this.$el=this._prepareEl(a),this.el=this.$el[0],this.$el.data("iggy",this),this.facets=this._prepareFacets(b,c),this.results=new o(null,c),this.results.on("add",this.triggerChange),this.results.on("remove",this.triggerChange),this.results.on("change",this.triggerChange),this.view=new n({main:this,el:this.$el,collection:this.facets,results:this.results,searchButton:c.searchButton,idx:m++}),this.view.on("searchbutton",this.triggerEvent),this.nonEmptyResults=this.results.sub(this._filterEmpty)}return q(b,a),b.prototype.$=jQuery,b.prototype._prepareEl=function(a){var b;if(null==a)throw this._error("EMISSINGEL");if(_.isString(a)){if(!a.length)throw this._error("EEMPTYELSTRING");if(b=this.$(a),!(null!=b?b.length:void 0))throw this._error("EINVALIDELSTRING");return b}if(a instanceof jQuery){if(!a.length)throw this._error("EEMPTYELJQUERY");if(a.length>1)throw this._error("ESIZEELJQUERY");return a}if(a instanceof Element)return this.$(a);throw this._error("EINVALIDELTYPE")},b.prototype._prepareFacets=function(a,b){var c,e,f,g,h,i;for(null==b&&(b={}),f=[],e=h=0,i=a.length;h<i;e=++h)g=a[e],null!=(c=this._createFacet(g))&&(c._idx=e,f.push(c));return new d(f,b)},b.prototype._createFacet=function(a){switch(a.type.toLowerCase()){case"string":return new k(a,{main:this});case"select":return new j(a,{main:this});case"array":return new e(a,{main:this});case"number":return new h(a,{main:this});case"range":return new i(a,{main:this});case"daterange":return new f(a,{main:this});case"event":return new g(a,{main:this})}},b.prototype.addFacet=function(a){var b;if(null!=this.facets)return null!=(b=this._createFacet(a))&&this.facets.add(b),this},b.prototype._error=function(a,b){var c,d;return null==b&&(b={}),d=null!=this.errors[a]?this.errors[a](b):"-",c=new Error,c.name=a,c.message=d,c},b.prototype._filterEmpty=function(a){var b;return b=a.get("value"),null!=b&&!(b.length<=0)},b.prototype.getQuery=function(){return this.nonEmptyResults},b.prototype.triggerChange=function(){setTimeout(function(a){return function(){return a.trigger("change",a.nonEmptyResults)}}(this),0)},b.prototype.triggerEvent=function(a){setTimeout(function(b){return function(){return b.trigger(a,b.nonEmptyResults)}}(this),0)},b.prototype._initErrors=function(){var a,b,c;this.errors={},c=this.ERRORS();for(a in c)b=c[a],this.errors[a]=_.template(b)},b.prototype.ERRORS=function(){return{EINVALIDELSTRING:"If you define a `el` as String it has to be a valid selector for an existing DOM element.",EEMPTYELSTRING:"The `el` as string can not be empty.",EEMPTYELJQUERY:"The `el` as jOuery object can not be an empty collection.",ESIZEELJQUERY:"The `el` as jOuery object can not be a result of one el.",EINVALIDELTYPE:"The `el` can only be a selector string, dom element or jQuery collection",EMISSINGEL:"Please define a target `el`"}},b}(Backbone.Events),b.exports=l},{"./models/facet_array":3,"./models/facet_daterange":5,"./models/facet_event":6,"./models/facet_number":7,"./models/facet_range":8,"./models/facet_select":9,"./models/facet_string":10,"./models/facets":11,"./models/results":12,"./views/main":34}],2:[function(a,b,c){var d,e=function(a,b){return function(){return a.apply(b,arguments)}},f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty,h=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};d=function(a){function b(){return this.updateSubFilter=e(this.updateSubFilter,this),this._subCollectionOptions=e(this._subCollectionOptions,this),this.sub=e(this.sub,this),b.__super__.constructor.apply(this,arguments)}return f(b,a),b.prototype.sub=function(a){var b,c,d;return this.subColls||(this.subColls=[]),d=this._generateSubFilter(a),b=this.filter(d),c=new this.constructor(b,this._subCollectionOptions()),c._parentCol=this,c._fnFilter=d,this.on("change",_.bind(function(a){var b,c;c=this._fnFilter(a),b=null!=this.get(a),b&&!c?this.remove(a):!b&&c&&this.add(a)},c)),c.on("add",_.bind(function(a){this.add(a)},this)),this.on("add",_.bind(function(a){this._fnFilter(a)&&this.add(a)},c)),c.on("remove",_.bind(function(a){},this)),this.on("remove",_.bind(function(a){this.remove(a)},c)),this.on("reset",_.bind(function(a){this.updateSubFilter()},c)),this.subColls.push(c),c},b.prototype._subCollectionOptions=function(){var a;return a={comparator:this.comparator}},b.prototype.updateSubFilter=function(a,b){var c,d,e,f,g,i,j,k,l,m,n,o;if(null==b&&(b=!0),null!=this._parentCol){if(null!=a&&(this._fnFilter=this._generateSubFilter(a)),d=this._parentCol.filter(this._fnFilter),b)return this.reset(d),this;for(l=_.pluck(d,"cid"),e=_.pluck(this.models,"cid"),m=_.difference(e,l),f=0,i=m.length;f<i;f++)o=m[f],this.remove(o);for(c=_.difference(l,e),g=0,j=d.length;g<j;g++)k=d[g],n=k.cid,h.call(c,n)>=0&&this.add(k)}return this},b.prototype._generateSubFilter=function(a){var b;return b=_.isFunction(a)?a:_.isArray(a)?function(b){var c;return c=b.id,h.call(a,c)>=0}:_.isString(a)||_.isNumber(a)?function(b){return b.id===a}:function(b){var c,d;for(c in a)if(d=a[c],b.get(c)!==d)return!1;return!0}},b}(Backbone.Collection),b.exports=d},{}],3:[function(a,b,c){var d,e=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},f={}.hasOwnProperty;d=function(b){function c(){return c.__super__.constructor.apply(this,arguments)}return e(c,b),c.prototype.SubView=a("../views/facets/subarray"),c}(a("./facet_string")),b.exports=d},{"../views/facets/subarray":29,"./facet_string":10}],4:[function(a,b,c){var d,e=function(a,b){return function(){return a.apply(b,arguments)}},f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty;d=function(b){function c(a,b){this.match=e(this.match,this),this.getLabel=e(this.getLabel,this),this.main=b.main,c.__super__.constructor.apply(this,arguments)}return f(c,b),c.prototype.idAttribute="name",c.prototype.SubView=a("../views/facets/base"),c.prototype.defaults=function(){return{type:"string",name:"name",label:"Description",sort:0}},c.prototype.getLabel=function(){return this.get("label")},c.prototype.match=function(a){var b,c;return b=this.get("name")+" "+this.get("label"),c=b.toLowerCase().indexOf(a.toLowerCase()),c>=0},c.prototype.comparator=function(a){return a.id},c}(Backbone.Model),b.exports=d},{"../views/facets/base":26}],5:[function(a,b,c){var d,e=function(a,b){return function(){return a.apply(b,arguments)}},f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty;d=function(b){function c(){return this.defaults=e(this.defaults,this),c.__super__.constructor.apply(this,arguments)}return f(c,b),c.prototype.SubView=a("../views/facets/daterange"),c.prototype.defaults=function(){return $.extend(c.__super__.defaults.apply(this,arguments),{opts:{},value:null})},c}(a("./facet_base")),b.exports=d},{"../views/facets/daterange":27,"./facet_base":4}],6:[function(a,b,c){var d,e=function(a,b){return function(){return a.apply(b,arguments)}},f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty;d=function(a){function b(){return this.exec=e(this.exec,this),this.defaults=e(this.defaults,this),b.__super__.constructor.apply(this,arguments)}return f(b,a),b.prototype.SubView=null,b.prototype.onlyExec=!0,b.prototype.defaults=function(){return $.extend(b.__super__.defaults.apply(this,arguments),{options:[]})},b.prototype.exec=function(){this.main.trigger(this.get("event"),this.toJSON())},b}(a("./facet_base")),b.exports=d},{"./facet_base":4}],7:[function(a,b,c){var d,e=function(a,b){return function(){return a.apply(b,arguments)}},f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty;d=function(b){function c(){return this.defaults=e(this.defaults,this),c.__super__.constructor.apply(this,arguments)}return f(c,b),c.prototype.SubView=a("../views/facets/subnumber"),c.prototype.defaults=function(){return $.extend(c.__super__.defaults.apply(this,arguments),{min:null,max:null,step:1,value:null})},c}(a("./facet_base")),b.exports=d},{"../views/facets/subnumber":30,"./facet_base":4}],8:[function(a,b,c){var d,e=function(a,b){return function(){return a.apply(b,arguments)}},f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty;d=function(b){function c(){return this.defaults=e(this.defaults,this),c.__super__.constructor.apply(this,arguments)}return f(c,b),c.prototype.SubView=a("../views/facets/subrange"),c.prototype.defaults=function(){return $.extend(c.__super__.defaults.apply(this,arguments),{min:null,max:null,step:1,value:null})},c}(a("./facet_base")),b.exports=d},{"../views/facets/subrange":31,"./facet_base":4}],9:[function(a,b,c){var d,e=function(a,b){return function(){return a.apply(b,arguments)}},f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty;d=function(b){function c(){return this.defaults=e(this.defaults,this),c.__super__.constructor.apply(this,arguments)}return f(c,b),c.prototype.SubView=a("../views/facets/subselect"),c.prototype.defaults=function(){return $.extend(c.__super__.defaults.apply(this,arguments),{options:[],waitForAsync:!0})},c}(a("./facet_base")),b.exports=d},{"../views/facets/subselect":32,"./facet_base":4}],10:[function(a,b,c){var d,e=function(a,b){return function(){return a.apply(b,arguments)}},f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty;d=function(b){function c(){return this.defaults=e(this.defaults,this),c.__super__.constructor.apply(this,arguments)}return f(c,b),c.prototype.SubView=a("../views/facets/substring"),c.prototype.defaults=function(){return $.extend(c.__super__.defaults.apply(this,arguments),{options:[]})},c}(a("./facet_base")),b.exports=d},{"../views/facets/substring":33,"./facet_base":4}],11:[function(a,b,c){var d,e,f,g=function(a,b){return function(){return a.apply(b,arguments)}},h=function(a,b){function c(){this.constructor=a}for(var d in b)i.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},i={}.hasOwnProperty;f=a("sortcoll"),e=function(a,b){return a.get(b)},d=function(a){function b(a,c){var d;return null==c&&(c={}),this._subCollecctionOptions=g(this._subCollecctionOptions,this),null==c.comparator&&(d=function(){switch(c.dir){case"asc":return!0;case"desc":return!1;default:return!0}}(),c.comparator=f(["sort"].concat(c.sortby||"name"),{sort:!1,"?":d},e)),b.__super__.constructor.call(this,a,c)}return h(b,a),b.prototype._subCollecctionOptions=function(){var a;return a=b.__super__._subCollecctionOptions.apply(this,arguments),a.dir=this.forward?"asc":"desc",a},b.prototype.modelId=function(a){return a.name},b}(a("./backbone_sub")),b.exports=d},{"./backbone_sub":2,sortcoll:39}],12:[function(a,b,c){var d,e,f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty,h=function(a,b){return function(){return a.apply(b,arguments)}};d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return f(b,a),b.prototype.idAttribute="name",b.prototype.defaults={type:"string",name:null,value:null},b}(Backbone.Model),e=function(a){function b(){return this.parse=h(this.parse,this),this.initialize=h(this.initialize,this),b.__super__.constructor.apply(this,arguments)}return f(b,a),b.prototype.model=d,b.prototype.initialize=function(a,b){var c;(null!=(c=b.modifyKey)?c.length:void 0)&&(this.modifyKey=b.modifyKey)},b.prototype.parse=function(a,b){var c,d,e;return c=b._facet.get("modifyKey")||this.modifyKey||"value",d=null!=(e=b._facet)?e.get("modify"):void 0,null!=d&&_.isFunction(d)&&(a[c]=d(a.value,b._facet,a)),a},b}(a("./backbone_sub")),b.exports=e},{"./backbone_sub":2}],13:[function(a,b,c){var d,e,f=function(a,b){return function(){return a.apply(b,arguments)}},g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;d=function(a){function b(){return this.getLabel=f(this.getLabel,this),b.__super__.constructor.apply(this,arguments)}return g(b,a),b.prototype.idAttribute="value",b.prototype.getLabel=function(){return this.get("label")||this.get(this.idAttribute)||""},b}(Backbone.Model),e=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return g(b,a),b.prototype.model=d,b}(a("./backbone_sub")),b.exports=e},{"./backbone_sub":2}],14:[function(a,b,c){var d=a("jade/runtime");b.exports=function(a){var b,c=[],e=a||{};return function(a,e,f){c.push('<span class="txt">'+d.escape(null==(b=f)?"":b)+'</span><span class="btn-wrp"><i'+d.attr("data-id",e,!0,!1)+' class="rm-result-btn fa fa-remove"></i>'),a&&c.push("<i"+d.attr("data-id",e,!0,!1)+' class="edit-result-btn fa fa-pencil"></i>'),c.push("</span>")}.call(this,"custom"in e?e.custom:"undefined"!=typeof custom?custom:void 0,"id"in e?e.id:"undefined"!=typeof id?id:void 0,"txt"in e?e.txt:"undefined"!=typeof txt?txt:void 0),c.join("")}},{"jade/runtime":38}],15:[function(a,b,c){var d=a("jade/runtime");b.exports=function(a){var b=[],c=a||{};return function(a){b.push("<input"+d.attr("id",a,!0,!1)+' class="daterange-inp"/>')}.call(this,"cid"in c?c.cid:"undefined"!=typeof cid?cid:void 0),b.join("")}},{"jade/runtime":38}],16:[function(a,b,c){var d=a("jade/runtime");b.exports=function(a){var b,c=[],e=a||{};return function(a,e,f,g,h){f&&f.length&&(c.push('<div class="operator"><select'+d.attr("id",""+a+"op",!0,!1)+">"),function(){var a=f;if("number"==typeof a.length)for(var g=0,h=a.length;g<h;g++){var i=a[g];c.push("<option"+d.attr("value",i,!0,!1)+d.attr("selected",e==i,!0,!1)+">"+d.escape(null==(b=i)?"":b)+"</option>")}else{var h=0;for(var g in a){h++;var i=a[g];c.push("<option"+d.attr("value",i,!0,!1)+d.attr("selected",e==i,!0,!1)+">"+d.escape(null==(b=i)?"":b)+"</option>")}}}.call(this),c.push("</select></div>")),c.push("<input"+d.attr("id",a,!0,!1)+d.attr("value",h,!0,!1)+' class="number-inp"/>')}.call(this,"cid"in e?e.cid:"undefined"!=typeof cid?cid:void 0,"operator"in e?e.operator:"undefined"!=typeof operator?operator:void 0,"operators"in e?e.operators:"undefined"!=typeof operators?operators:void 0,"undefined"in e?e.undefined:void 0,"value"in e?e.value:"undefined"!=typeof value?value:void 0),c.join("")}},{"jade/runtime":38}],17:[function(a,b,c){var d=a("jade/runtime");b.exports=function(a){var b=[],c=a||{};return function(a,c){b.push('<div class="rangeinp">');var e=c?c:[];b.push("<input"+d.attr("id",""+a+"_from",!0,!1)+d.attr("value",e[0],!0,!1)+' class="number-inp range-from"/><span class="separator">-</span><input'+d.attr("id",""+a+"_to",!0,!1)+d.attr("value",e[1],!0,!1)+' class="number-inp range-to"/></div>')}.call(this,"cid"in c?c.cid:"undefined"!=typeof cid?cid:void 0,"value"in c?c.value:"undefined"!=typeof value?value:void 0),b.join("")}},{"jade/runtime":38}],18:[function(a,b,c){a("jade/runtime");b.exports=function(a){var b=[];return b.join("")}},{"jade/runtime":38}],19:[function(a,b,c){var d=a("jade/runtime");b.exports=function(a){var b,c=[],e=a||{};return function(a,e,f,g,h,i){c.push("<select"+d.attr("id",a,!0,!1)+' multiple="multiple" class="select-inp">'),f?function(){var a=f;if("number"==typeof a.length)for(var e=0,g=a.length;e<g;e++){var h=a[e];c.push("<optgroup"+d.attr("label",e,!0,!1)+"></optgroup>"),function(){var a=h;if("number"==typeof a.length)for(var e=0,f=a.length;e<f;e++){var g=a[e];c.push("<option"+d.attr("value",g.value,!0,!1)+d.attr("selected",i&&i.indexOf(g.value)>=0,!0,!1)+">"+d.escape(null==(b=g.label)?"":b)+"</option>")}else{var f=0;for(var e in a){f++;var g=a[e];c.push("<option"+d.attr("value",g.value,!0,!1)+d.attr("selected",i&&i.indexOf(g.value)>=0,!0,!1)+">"+d.escape(null==(b=g.label)?"":b)+"</option>")}}}.call(this)}else{var g=0;for(var e in a){g++;var h=a[e];c.push("<optgroup"+d.attr("label",e,!0,!1)+"></optgroup>"),function(){var a=h;if("number"==typeof a.length)for(var e=0,f=a.length;e<f;e++){var g=a[e];c.push("<option"+d.attr("value",g.value,!0,!1)+d.attr("selected",i&&i.indexOf(g.value)>=0,!0,!1)+">"+d.escape(null==(b=g.label)?"":b)+"</option>")}else{var f=0;for(var e in a){f++;var g=a[e];c.push("<option"+d.attr("value",g.value,!0,!1)+d.attr("selected",i&&i.indexOf(g.value)>=0,!0,!1)+">"+d.escape(null==(b=g.label)?"":b)+"</option>")}}}.call(this)}}}.call(this):function(){var a=g;if("number"==typeof a.length)for(var e=0,f=a.length;e<f;e++){var h=a[e];c.push("<option"+d.attr("value",h.value,!0,!1)+d.attr("selected",i&&i.indexOf(h.value)>=0,!0,!1)+">"+d.escape(null==(b=h.label)?"":b)+"</option>")}else{var f=0;for(var e in a){f++;var h=a[e];c.push("<option"+d.attr("value",h.value,!0,!1)+d.attr("selected",i&&i.indexOf(h.value)>=0,!0,!1)+">"+d.escape(null==(b=h.label)?"":b)+"</option>")}}}.call(this),c.push("</select>"),e&&c.push('<span class="btn btn-xs btn-success select-check fa fa-check"></span>')}.call(this,"cid"in e?e.cid:"undefined"!=typeof cid?cid:void 0,"multiple"in e?e.multiple:"undefined"!=typeof multiple?multiple:void 0,"optionGroups"in e?e.optionGroups:"undefined"!=typeof optionGroups?optionGroups:void 0,"options"in e?e.options:"undefined"!=typeof options?options:void 0,"undefined"in e?e.undefined:void 0,"value"in e?e.value:"undefined"!=typeof value?value:void 0),c.join("")}},{"jade/runtime":38}],20:[function(a,b,c){var d=a("jade/runtime");b.exports=function(a){var b=[],c=a||{};return function(a,c){b.push("<input"+d.attr("id",a,!0,!1)+d.attr("value",c,!0,!1)+' class="selector-inp"/><ul'+d.attr("id",""+a+"typelist",!0,!1)+' class="typelist"></ul>')}.call(this,"cid"in c?c.cid:"undefined"!=typeof cid?cid:void 0,"inpval"in c?c.inpval:"undefined"!=typeof inpval?inpval:void 0),b.join("")}},{"jade/runtime":38}],21:[function(a,b,c){var d=a("jade/runtime");b.exports=function(a){var b,c=[],e=a||{};return function(a,e,f,g,h){var i=0;e&&g&&(i=1,c.push('<li><a data-id="_custom" data-idx="-1"'+d.cls([{active:0===a}],[!0])+'><i>"'+(null==(b=g)?"":b)+'"</i></a></li>')),f.length?function(){var e=f;if("number"==typeof e.length)for(var g=0,h=e.length;g<h;g++){var j=e[g];c.push("<li"+d.cls([j.cssclass],[!0])+"><a"+d.attr("data-id",j.id,!0,!1)+d.attr("data-idx",g,!0,!1)+d.cls([{active:g+i===a}],[!0])+">"+(null==(b=j.label)?"":b)+"</a></li>")}else{var h=0;for(var g in e){h++;var j=e[g];c.push("<li"+d.cls([j.cssclass],[!0])+"><a"+d.attr("data-id",j.id,!0,!1)+d.attr("data-idx",g,!0,!1)+d.cls([{active:g+i===a}],[!0])+">"+(null==(b=j.label)?"":b)+"</a></li>")}}}.call(this):e||c.push('<li><a class="emptyres">no result for "'+d.escape(null==(b=g)?"":b)+'"</a></li>')}.call(this,"activeIdx"in e?e.activeIdx:"undefined"!=typeof activeIdx?activeIdx:void 0,"custom"in e?e.custom:"undefined"!=typeof custom?custom:void 0,"list"in e?e.list:"undefined"!=typeof list?list:void 0,"query"in e?e.query:"undefined"!=typeof query?query:void 0,"undefined"in e?e.undefined:void 0),c.join("")}},{"jade/runtime":38}],22:[function(a,b,c){var d=a("jade/runtime");b.exports=function(a){var b=[],c=a||{};return function(a,c){b.push("<input"+d.attr("id",a,!0,!1)+d.attr("value",c,!0,!1)+' class="string-inp"/>')}.call(this,"cid"in c?c.cid:"undefined"!=typeof cid?cid:void 0,"value"in c?c.value:"undefined"!=typeof value?value:void 0),b.join("")}},{"jade/runtime":38}],23:[function(a,b,c){var d=a("jade/runtime");b.exports=function(a){var b,c=[],e=a||{};return function(a,e,f,g){e||c.push('<div class="rm-facet-btn fa fa-remove"></div>'),c.push('<span class="sublabel">'+d.escape(null==(b=a)?"":b)+':</span><ul class="subresults">'),f&&f.length&&function(){var a=f;if("number"==typeof a.length)for(var e=0,g=a.length;e<g;e++){var h=a[e];c.push('<li><span class="txt">'+d.escape(null==(b=h)?"":b)+'</span><i class="rm-facet-btn fa fa-remove"></i></li>')}else{var g=0;for(var e in a){g++;var h=a[e];c.push('<li><span class="txt">'+d.escape(null==(b=h)?"":b)+'</span><i class="rm-facet-btn fa fa-remove"></i></li>')}}}.call(this),c.push('</ul><div class="subselect closed"></div><div class="loader"><i class="fa fa-cog fa-spin"></i></div>')}.call(this,"label"in e?e.label:"undefined"!=typeof label?label:void 0,"pinned"in e?e.pinned:"undefined"!=typeof pinned?pinned:void 0,"selected"in e?e.selected:"undefined"!=typeof selected?selected:void 0,"undefined"in e?e.undefined:void 0),c.join("")}},{"jade/runtime":38}],24:[function(a,b,c){var d=a("jade/runtime");b.exports=function(a){var b,c=[],e=a||{};return function(a){c.push('<button class="add-facet-btn fa fa-plus"></button>'),void 0!=a&&void 0!=a.template&&a.template.length>=0&&c.push("<button"+d.cls(["search-btn",a.cssclass,{"search-btn-pullright":a.pullright}],[null,!0,!0])+">"+(null==(b=a.template)?"":b)+"</button>")}.call(this,"searchButton"in e?e.searchButton:"undefined"!=typeof searchButton?searchButton:void 0),c.join("")}},{"jade/runtime":38}],25:[function(a,b,c){b.exports={LEFT:37,RIGHT:39,UP:38,DOWN:40,ESC:[229,27],ENTER:13,TAB:9}},{}],26:[function(a,b,c){var d,e,f,g=function(a,b){return function(){return a.apply(b,arguments)}},h=function(a,b){function c(){this.constructor=a}for(var d in b)i.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},i={}.hasOwnProperty,j=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};e=a("../../utils/keycodes"),f=a("../../models/subresults"),d=function(b){function c(){return this.set=g(this.set,this),this.select=g(this.select,this),this._checkSelectEmpty=g(this._checkSelectEmpty,this),this.getValue=g(this.getValue,this),this.isEqualCurrent=g(this.isEqualCurrent,this),this.getResValue=g(this.getResValue,this),this.isResultEmpty=g(this.isResultEmpty,this),this.getResults=g(this.getResults,this),this.close=g(this.close,this),this._onTabAction=g(this._onTabAction,this),this.render=g(this.render,this),this.reopen=g(this.reopen,this),this._getInpSelector=g(this._getInpSelector,this),this.getTemplateData=g(this.getTemplateData,this),this._onKey=g(this._onKey,this),this.input=g(this.input,this),this.open=g(this.open,this),this.renderResult=g(this.renderResult,this),this.focus=g(this.focus,this),this.events=g(this.events,this),this.initialize=g(this.initialize,this),c.__super__.constructor.apply(this,arguments)}return h(c,b),c.prototype.resultTemplate=a("../../tmpls/result_base.jade"),c.prototype.initialize=function(a){this.sub=a.sub,this.result=new f},c.prototype.events=function(){var a;return a={},a["keyup "+this._getInpSelector()]="input",a["keydown "+this._getInpSelector()]="input",a},c.prototype.focus=function(){this.$el.removeClass("closed"),this.focused=!0,this.$inp.focus()},c.prototype.renderResult=function(a){var b,c,d,e,f,g,h;if(null==a&&(a=!1),a)return"";for(c=[],h=this.result.models,e=d=0,f=h.length;d<f;e=++d)g=h[e],b=g.getLabel(),null!=b&&""!==b&&c.push(g.getLabel());return c.length?"<li>"+c.join("</li><li>")+"</li>":""},c.prototype.open=function(){this.$el.removeClass("closed"),this.$el.addClass("open"),this.isOpen=!0,this.trigger("opened")},c.prototype.input=function(a){if("keydown"===a.type)switch(a.keyCode){case e.ENTER:this.select()}},c.prototype._onKey=function(a){var b;if(a.keyCode===e.TAB||(b=a.keyCode,j.call(e.TAB,b)>=0))return void this._onTabAction(a)},c.prototype.getTemplateData=function(){var a,b;return b={cid:this.cid,value:null!=(a=this.model)?a.get("value"):void 0}},c.prototype._getInpSelector=function(){return"input#"+this.cid},c.prototype.reopen=function(a){this.$el.removeClass("closed"),this.$el.addClass("open"),this.render(),null!=a&&a.open()},c.prototype.render=function(a){var b;b=this.template(this.getTemplateData()),this.$el.html(b),a||this.$el.removeClass("closed"),this.$inp=this.$el.find(this._getInpSelector())},c.prototype._hasTabEvent=function(){return"keydown"},c.prototype._hasTabListener=function(){return!0},c.prototype._onTabAction=function(a){return a.preventDefault(),a.stopPropagation(),this.select(),!0},c.prototype.close=function(a){this.focused=!1,this.$el.removeClass("open"),this.$el.addClass("closed"),this.isOpen=!1,this.trigger("closed",this.result,a)},c.prototype.getResults=function(){return{value:this.getValue()}},c.prototype.isResultEmpty=function(a){return null!=(null!=a?a.value:void 0)?this.isResultEmpty(a.value):null==a||(""===a||!!(_.isArray(a)&&a.length<=0))},c.prototype.getResValue=function(){var a,b,c;return c=null!=(a=this.result)&&null!=(b=a.first())?b.toJSON():void 0,(null!=c?c.value:void 0)||""},c.prototype.isEqualCurrent=function(a){var b;return null==a&&(a=this.getValue()),b=this.getResValue(),b===a},c.prototype.getValue=function(){return this.$inp.val()},c.prototype.getSelectModel=function(){return f.prototype.model},c.prototype._checkSelectEmpty=function(a,b){return!(!_.isEmpty(a)||_.isNumber(a)||_.isBoolean(a))&&(this.close(b),!0)},c.prototype.select=function(a){var b;b=this.getValue(),this.set(b,a)},c.prototype.set=function(a,b){var c,d;d=this.result.first(),null==d?(c=this.getSelectModel(),d=new c({value:a}),this.result.add(d)):d.set({value:a}),this.trigger("selected",d,b),this.close(b)},c}(Backbone.View),b.exports=d},{"../../models/subresults":13,"../../tmpls/result_base.jade":18,"../../utils/keycodes":25}],27:[function(a,b,c){var d,e,f=function(a,b){return function(){return a.apply(b,arguments)}},g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;e=a("../../utils/keycodes"),d=function(b){function c(){return this.select=f(this.select,this),this.getValue=f(this.getValue,this),this.getTemplateData=f(this.getTemplateData,this),this._dateReturn=f(this._dateReturn,this),this.renderResult=f(this.renderResult,this),this.remove=f(this.remove,this),this.close=f(this.close,this),this.focus=f(this.focus,this),this.events=f(this.events,this),this.forcedDateRangeOpts=f(this.forcedDateRangeOpts,this),c.__super__.constructor.apply(this,arguments)}return g(c,b),c.prototype.template=a("../../tmpls/daterange.jade"),c.prototype.forcedDateRangeOpts=function(){var a,b,c,d,e,f;return b={opens:"right"},this.model.get("dateformat")&&(b.locale={format:this.model.get("dateformat")}),null!=(null!=(d=this.model.get("value"))?d[0]:void 0)&&(null!=(null!=(e=this.model.get("value"))?e[1]:void 0),c=_.isNumber(this.model.get("value")[0])?moment(this.model.get("value")[0]):moment(this.model.get("value")[0],this.model.get("dateformat")),c.isValid()&&(b.startDate=c._d)),null!=(null!=(f=this.model.get("value"))?f[1]:void 0)&&(a=_.isNumber(this.model.get("value")[1])?moment(this.model.get("value")[1]):moment(this.model.get("value")[1],this.model.get("dateformat")),a.isValid()&&(b.endDate=a._d)),b},c.prototype.events=function(){},c.prototype.focus=function(){var a,b;return null==this.daterangepicker?(a=_.extend({},this.model.get("opts"),this.forcedDateRangeOpts()),this.$inp.daterangepicker(a,this._dateReturn),this.daterangepicker=this.$inp.data("daterangepicker"),null!=(b=this.daterangepicker.container)&&b.addClass("daterange-iggy"),this.daterangepicker.container.on("click",function(a){return a.stopPropagation(),!1})):(this.daterangepicker.element=this.$inp,this.daterangepicker.show()),this.$inp.on("cancel.daterangepicker",this.close),this.$inp.on("hide.daterangepicker",this.close),c.__super__.focus.apply(this,arguments)},c.prototype.close=function(){c.__super__.close.apply(this,arguments),this.$inp.off("cancel.daterangepicker",this.close),this.$inp.off("hide.daterangepicker",this.close)},c.prototype.remove=function(){var a;return null!=(a=this.daterangepicker)&&a.remove(),this.daterangepicker=null,c.__super__.remove.apply(this,arguments)},c.prototype.renderResult=function(){var a,b,c,d,e,f;return c=this.getResults(),e=_.isNumber(c.value[0])?moment(c.value[0]):moment(c.value[0],this.model.get("dateformat")),null!=c.value[1]&&(a=_.isNumber(c.value[1])?moment(c.value[1]):moment(c.value[1],this.model.get("dateformat"))),f=this.model.get("opts").timePicker,d="<li>",b=null!=this.model.get("dateformat")?this.model.get("dateformat"):f?"LLLL":"LL",d+=e.format(b),null!=a&&(d+=" - ",d+=a.format(b)),d+="</li>"},c.prototype._hasTabListener=function(){return!1},c.prototype._dateReturn=function(a,b){this.startDate=a,this.endDate=b,this.model.set("value",this.getValue(!1)),this.select()},c.prototype.getTemplateData=function(){return c.__super__.getTemplateData.apply(this,arguments)},c.prototype.getValue=function(a){var b,c;return null==a&&(a=!0),a&&(c=this.model.get("value"),null!=c)?(_.isArray(c)||(c=[c]),this.startDate=c[0],this.endDate=c[1],c):(b=[this.startDate.valueOf()],null!=this.endDate&&b.push(this.endDate.valueOf()),b)},c.prototype.select=function(){var a,b;a=this.getSelectModel(),b=new a({value:this.getValue()}),this.result.add(b),this.trigger("selected",b),this.close()},c}(a("./base")),b.exports=d},{"../../tmpls/daterange.jade":15,"../../utils/keycodes":25,"./base":26}],28:[function(a,b,c){var d,e,f,g,h=function(a,b){return function(){return a.apply(b,arguments)}},i=function(a,b){function c(){this.constructor=a}for(var d in b)j.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},j={}.hasOwnProperty;e=a("../../utils/keycodes"),f=function(a,b){return a/=b,a=Math.round(a)*b},g=function(a,b){return b=Math.pow(10,b),a*=b,a=Math.round(a),a/=b},d=function(a){function b(){this._setNumber=h(this._setNumber,this),this.getValue=h(this.getValue,this),
this.crement=h(this.crement,this),this.input=h(this.input,this),this.events=h(this.events,this),this.setNumber=_.throttle(this._setNumber,300,{leading:!1,trailing:!1}),b.__super__.constructor.apply(this,arguments)}return i(b,a),b.prototype.events=function(){var a;return a={},a["keyup "+this._getInpSelector()]="input",a["keydown "+this._getInpSelector()]="input",a},b.prototype.input=function(a){var b,c;if(b=$(a.currentTarget),"keydown"===a.type)switch(a.keyCode){case e.UP:return void this.crement(this.model.get("step"),b);case e.DOWN:return void this.crement(this.model.get("step")*-1,b);case e.ENTER:return void this.select()}"keyup"===a.type&&(c=a.currentTarget.value.replace(/[^\d]?[^-\d]+/g,""),c=parseInt(c,10),this.setNumber(c,b))},b.prototype.crement=function(a,b){var c;null==b&&(b=this.$inp),c=b.val(),c=(null!=c?c.length:void 0)?parseInt(c,10):this.model.get("value"),this._setNumber(c+a,b)},b.prototype.getValue=function(){var a,b;return b=this.$inp.val(),(null!=b?b.length:void 0)?(a=parseInt(b,10),isNaN(a)?null:this.valueByDefinition(b)):null},b.prototype._setNumber=function(a,b){var c;null==b&&(b=this.$inp),isNaN(a)||(c=b.val(),a=this.valueByDefinition(a),c!==a.toString()&&b.val(a))},b.prototype.valueByDefinition=function(a){var b,c,d,e,h;return d=this.model.get("max"),e=this.model.get("min"),h=this.model.get("step"),e>d&&(c=e,e=d,d=c),null!=e&&a<e?e:null!=d&&a>d?d:(1!==h&&(a=f(a,h)),b=Math.max(0,Math.ceil(Math.log(1/h)/Math.log(10))),a=b>0?g(a,b):Math.round(a))},b}(a("./base")),b.exports=d},{"../../utils/keycodes":25,"./base":26}],29:[function(a,b,c){var d,e,f,g,h,i,j,k=function(a,b){return function(){return a.apply(b,arguments)}},l=function(a,b){function c(){this.constructor=a}for(var d in b)m.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},m={}.hasOwnProperty;j=a("../../models/subresults"),g=a("../../utils/keycodes"),h=function(a){function b(){return this.match=k(this.match,this),b.__super__.constructor.apply(this,arguments)}return l(b,a),b.prototype.match=function(a){var b,c;return b=this.get("value")+" "+this.get("label"),c=b.toLowerCase().indexOf(a.toLowerCase()),c>=0},b}(j.prototype.model),i=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return l(b,a),b.prototype.model=h,b}(j),d=function(a){function b(){return this.match=k(this.match,this),this.getLabel=k(this.getLabel,this),b.__super__.constructor.apply(this,arguments)}return l(b,a),b.prototype.idAttribute="value",b.prototype.getLabel=function(){return this.get("label")||this.get("name")||"-"},b.prototype.match=function(a){var b,c;return b=this.get("value")+" "+this.get("label"),c=b.toLowerCase().indexOf(a.toLowerCase()),c>=0},b}(Backbone.Model),e=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return l(b,a),b.prototype.model=d,b}(a("../../models/backbone_sub")),f=function(b){function c(a){this._createOptionCollection=k(this._createOptionCollection,this),this._onTabAction=k(this._onTabAction,this),this.getResults=k(this.getResults,this),this.reopen=k(this.reopen,this),this.select=k(this.select,this),this._isFull=k(this._isFull,this),this.renderResult=k(this.renderResult,this),this.getTemplateData=k(this.getTemplateData,this),this.editRes=k(this.editRes,this),this.rmRes=k(this.rmRes,this),this.close=k(this.close,this),this.events=k(this.events,this),this.initialize=k(this.initialize,this),this.loading=!1,null!=a.model.get("count")&&(this.selectCount=a.model.get("count")),a.custom=!0,null!=a.model.get("custom")&&(a.custom=Boolean(a.model.get("custom"))),this.collection=this._createOptionCollection(a.model.get("options")),!a.custom&&this.selectCount<=0&&(this.selectCount=this.collection.length),c.__super__.constructor.call(this,a),this.result.on("remove",function(b){return function(c,d){d.length&&a.sub.renderResult(),b.searchcoll.add(c),b.trigger("removed",c)}}(this))}return l(c,b),c.prototype.templateResLi=a("../../tmpls/array_resultli.jade"),c.prototype.optDefault={label:"-",value:"-"},c.prototype.selectCount=0,c.prototype.optColl=i,c.prototype.initialize=function(){return this.editMode=!1,c.__super__.initialize.apply(this,arguments)},c.prototype.events=function(){var a;return a=c.__super__.events.apply(this,arguments),a["blur input#"+this.cid]="close",a},c.prototype.close=function(a){var b,d;return b=!1,this.editMode&&(b=!0),this.editMode=!1,this.loading?(null!=a&&a.preventDefault(),null!=a&&a.stopPropagation(),void this.focus()):(null!=(d=this.model)?d.get("pinned"):void 0)?c.__super__.close.apply(this,arguments):(b&&this.result.length<=0&&this.sub.del(),c.__super__.close.apply(this,arguments))},c.prototype.rmRes=function(a){var b,c,d;null!=(null!=a?a.target:void 0)?b=null!=(d=$(a.target))?d.data("id"):void 0:null!=a&&(b=a),c=this.result.get(b),null!=c&&(this.result.remove(b),(null!=c?c.get("custom"):void 0)&&this.searchcoll.remove(b))},c.prototype.editRes=function(a){var b,c,d;this.editMode=!0,b=null!=(d=$(a.target))?d.data("id"):void 0,c=this._editval=this.result.get(b).get("value"),this.result.remove(b),this.searchcoll.remove(b),this.sub.reopen(),this.search(c)},c.prototype.getTemplateData=function(){var a,b;return a=c.__super__.getTemplateData.apply(this,arguments),(null!=(b=this._editval)?b.length:void 0)&&(a.inpval=this._editval,this._editval=null),a},c.prototype.renderResult=function(a){var b,c,d,e,f,g;if(null==a&&(a=!1),a)return"<li></li>";for(b=[],g=this.result.models,d=c=0,e=g.length;c<e;d=++c)f=g[d],b.push(this.templateResLi({txt:f.getLabel(),id:f.id,custom:f.get("custom")}));return"<li>"+b.join("</li><li>")+"</li>"},c.prototype._isFull=function(){return!(this.selectCount<=0)&&(this.result||[]).length>=this.selectCount},c.prototype.select=function(){var a,b,c,d,e,f;if(!this.loading&&!this._isFull()&&(c=this.model.get("value"),null==c||_.isArray(c)||(c=[c]),null!=c?c.length:void 0)){for(f=this.selectCount<=0?c:c.slice(0,this.selectCount),d=0,e=f.length;d<e;d++)b=f[d],a=this.collection.get(b),null==a&&(a=new this.collection.model({value:b,custom:!0})),this.selected(a);this.close()}},c.prototype.reopen=function(a){return this._isFull()?void c.__super__.reopen.apply(this,arguments):void c.__super__.reopen.apply(this,arguments)},c.prototype.getResults=function(){return{value:this.result.pluck("value")}},c.prototype._onTabAction=function(a){var b;return a.preventDefault(),a.stopPropagation(),b=this.$inp.val(),(null!=b?b.length:void 0)?(this.selectActive(),!0):(this.close(),!0)},c.prototype._createOptionCollection=function(a){var b,c,d,e,f;if(_.isFunction(a))return this.loading=!0,b=new this.optColl([]),setTimeout(function(c){return function(){return c.$el.parent().addClass("loading"),a(c.result,c.model,function(a){var d,e,f,g;for(f=e=0,g=a.length;e<g;f=++e)d=a[f],a[f]=_.extend({},c.optDefault,d,{custom:!1});b.add(a),c.loading=!1,c.$el.parent().removeClass("loading"),c.select()})}}(this),0),b;for(c=[],d=0,e=a.length;d<e;d++)f=a[d],_.isString(f)||_.isNumber(f)?c.push({value:f,label:f}):_.isObject(f)&&c.push(_.extend({},this.optDefault,f));return new this.optColl(c)},c}(a("../selector")),b.exports=f},{"../../models/backbone_sub":2,"../../models/subresults":13,"../../tmpls/array_resultli.jade":14,"../../utils/keycodes":25,"../selector":35}],30:[function(a,b,c){var d,e=function(a,b){return function(){return a.apply(b,arguments)}},f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty;d=function(b){function c(){return this.getResults=e(this.getResults,this),this._onTabAction=e(this._onTabAction,this),this.getTemplateData=e(this.getTemplateData,this),this.reopen=e(this.reopen,this),this.focus=e(this.focus,this),this._opSelected=e(this._opSelected,this),this.select=e(this.select,this),this.close=e(this.close,this),this.renderResult=e(this.renderResult,this),this.render=e(this.render,this),this.events=e(this.events,this),c.__super__.constructor.apply(this,arguments)}return f(c,b),c.prototype.template=a("../../tmpls/number.jade"),c.prototype.events=function(){var a;return a=c.__super__.events.apply(this,arguments),a["blur "+this._getInpSelector()]="select",a},c.prototype.render=function(){var a;c.__super__.render.apply(this,arguments),(null!=(a=this.model.get("operators"))?a.length:void 0)&&(this.$elOp=this.$el.find(".operator"),this.elOp=this.$elOp.get(0),this.$inpOp=this.$el.find("select#"+this.cid+"op"),this.select2Op=this.$inpOp.select2({width:"auto"}).data("select2"),this.$inpOp.on("select2:close",this._opSelected))},c.prototype.renderResult=function(a){var b,c;return null==a&&(a=!1),a?"":(b=this.getResults(),c="<li>",null!=b.operator&&(c+=b.operator+" "),c+=b.value,c+="</li>")},c.prototype.close=function(a){null!=this.$inpOp&&(this.$inpOp.select2("destroy"),this.$inpOp.remove(),this.$inpOp=null),c.__super__.close.apply(this,arguments)},c.prototype.select=function(a){var b,d,e,f,g;if(b=-1,null==a||!a.relatedTarget||(b=null!=(f=this.elOp)?f.compareDocumentPosition(null!=a?a.relatedTarget:void 0):void 0,20!==b)){if("focusout"===(null!=a?a.type:void 0)&&20!==b)return e=this.getValue(),null!=e?void this.set(e,a):void this.close();if(null!=(null!=a?a.relatedTarget:void 0)&&(d=this.el.compareDocumentPosition(null!=a?a.relatedTarget:void 0),!(0===d||d-16>=0)))return void a.stopPropagation();if(null!=a&&((null!=a?a.relatedTarget:void 0)===this.$inp.get(0)||(null!=a?a.relatedTarget:void 0)===(null!=(g=this.$inpOp)?g.get(0):void 0)))return void a.stopPropagation();null!=this.$inpOp&&this.model.set({operator:this.$inpOp.val()}),c.__super__.select.apply(this,arguments)}},c.prototype._opSelected=function(){this.selectedOP=!0,this.focus()},c.prototype.focus=function(a){return null==a&&(a=!1),null==this.$inpOp||this.selectedOP?(c.__super__.focus.apply(this,arguments),void this.$inp.select()):void this.$inpOp.select2("open")},c.prototype.reopen=function(a){var b,d,e;d=null!=(e=this.result.first())?e.get("value"):void 0,b=this.result.first(),this.model.set({value:d}),a.$results.empty().html(this.renderResult(!0)),c.__super__.reopen.apply(this,arguments)},c.prototype.getTemplateData=function(){return _.extend(c.__super__.getTemplateData.apply(this,arguments),{operators:this.model.get("operators"),operator:this.model.get("operator")})},c.prototype._onTabAction=function(a){var b,c;if(null!=(c=this.model.get("operators"))?c.length:void 0){if(this.$inp.is(a.target)&&a.shiftKey)return a.stopPropagation(),a.preventDefault(),this.$inpOp.focus(),!1;if((this.select2Op.$selection.is(a.target)||a.target.classList.contains("select2-search__field"))&&!a.shiftKey)return a.stopPropagation(),a.preventDefault(),this.$inp.focus().select(),!1}return b=this.getValue(),a.preventDefault(),a.stopPropagation(),isNaN(b)||this.select(a),!0},c.prototype.getResults=function(){var a,b;return a=null!=this.$inpOp||null!=this.model.get("operator")?{value:this.getValue(),operator:(null!=(b=this.$inpOp)?b.val():void 0)||this.model.get("operator")}:{value:this.getValue()}},c}(a("./number_base")),b.exports=d},{"../../tmpls/number.jade":16,"./number_base":28}],31:[function(a,b,c){var d,e=function(a,b){return function(){return a.apply(b,arguments)}},f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty;d=function(b){function c(){return this._onTabAction=e(this._onTabAction,this),this.getValue=e(this.getValue,this),this.getResults=e(this.getResults,this),this.close=e(this.close,this),this.select=e(this.select,this),this.reopen=e(this.reopen,this),this.clickSel=e(this.clickSel,this),this.focus=e(this.focus,this),this.render=e(this.render,this),this.renderResult=e(this.renderResult,this),this.events=e(this.events,this),this._getInpSelector=e(this._getInpSelector,this),c.__super__.constructor.apply(this,arguments)}return f(c,b),c.prototype.template=a("../../tmpls/range.jade"),c.prototype._getInpSelector=function(a){return null==a&&(a="_from"),"input#"+this.cid+a},c.prototype.events=function(){var a;return a={},a["keyup "+this._getInpSelector()]="input",a["keydown "+this._getInpSelector()]="input",a["keyup "+this._getInpSelector("_to")]="input",a["keydown "+this._getInpSelector("_to")]="input",a["blur "+this._getInpSelector()]="select",a["blur "+this._getInpSelector("_to")]="select",a["mousedown "+this._getInpSelector()]="clickSel",a["mousedown "+this._getInpSelector("_to")]="clickSel",a},c.prototype.renderResult=function(a){var b;return null==a&&(a=!1),a?"":(b=this.getResults(),"<li>"+b.value.join(" - ")+"</li>")},c.prototype.render=function(){c.__super__.render.apply(this,arguments),this.$inpTo=this.$el.find(this._getInpSelector("_to"))},c.prototype.focus=function(a){null==a&&(a=!1),c.__super__.focus.apply(this,arguments),this.$inp.select()},c.prototype.clickSel=function(a){a.currentTarget.focus()},c.prototype.reopen=function(a){var b;b=this.result.first().get("value"),this.model.set({value:b}),a.$results.empty().html(this.renderResult(!0)),c.__super__.reopen.apply(this,arguments)},c.prototype.select=function(a){return null==a||(null!=a?a.relatedTarget:void 0)!==this.$inp.get(0)&&(null!=a?a.relatedTarget:void 0)!==this.$inpTo.get(0)?void c.__super__.select.apply(this,arguments):void a.stopPropagation()},c.prototype.close=function(){try{this.$(".rangeinp").remove()}catch(a){}c.__super__.close.apply(this,arguments)},c.prototype.getResults=function(){var a;return a={value:this.getValue()}},c.prototype.getValue=function(){var a,b,d;return b=c.__super__.getValue.apply(this,arguments),a=this.$inpTo.val(),(null!=a?a.length:void 0)?(d=parseInt(this.valueByDefinition(a),10),[b,d]):null},c.prototype._onTabAction=function(a){var b;return this.$inp.is(a.target)&&!a.shiftKey?(a.stopPropagation(),a.preventDefault(),this.$inpTo.focus().select(),console.log("focus next"),!1):this.$inpTo.is(a.target)&&a.shiftKey?(a.stopPropagation(),a.preventDefault(),this.$inp.focus().select(),!1):(b=this.getValue(),!((null!=b?b.length:void 0)>=2)||(a.preventDefault(),a.stopPropagation(),this.select(),!0))},c}(a("./number_base")),b.exports=d},{"../../tmpls/range.jade":17,"./number_base":28}],32:[function(a,b,c){var d,e,f=function(a,b){return function(){return a.apply(b,arguments)}},g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty,i=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};e=a("../../utils/keycodes"),d=function(b){function c(){return this._select=f(this._select,this),this.select=f(this.select,this),this.close=f(this.close,this),this.unselect=f(this.unselect,this),this._createOptionCollection=f(this._createOptionCollection,this),this.getResults=f(this.getResults,this),this._convertValue=f(this._convertValue,this),this.getValue=f(this.getValue,this),this._hasTabListener=f(this._hasTabListener,this),this.getTemplateData=f(this.getTemplateData,this),this.remove=f(this.remove,this),this._initSelect2=f(this._initSelect2,this),this._checkIntValue=f(this._checkIntValue,this),this.reopen=f(this.reopen,this),this._isFull=f(this._isFull,this),this.focus=f(this.focus,this),this.render=f(this.render,this),this._getInpSelector=f(this._getInpSelector,this),this.events=f(this.events,this),c.__super__.constructor.apply(this,arguments)}return g(c,b),c.prototype.template=a("../../tmpls/select.jade"),c.prototype.forcedModuleOpts={},c.prototype.defaultModuleOpts={width:"auto",multiple:!1},c.prototype.initialize=function(){this.convertValueToInt=this._checkIntValue(this.model.get("options")),c.__super__.initialize.apply(this,arguments)},c.prototype.events=function(){var a;return a={},this.model.get("multiple")&&(a["click .select-check"]="select"),a},c.prototype._getInpSelector=function(){return"select#"+this.cid},c.prototype.render=function(){c.__super__.render.apply(this,arguments),this.model.get("pinned")&&this._initSelect2()},c.prototype.focus=function(){return this.model.set("waitForAsync",!1),this._initSelect2(),this.select2.$container.show(),this.select2.open(),c.__super__.focus.apply(this,arguments)},c.prototype._isFull=function(){return!(this.selectCount<=0)&&(this.result||[]).length>=this.selectCount},c.prototype.reopen=function(a){var b;if(!this._isFull())return b=this.result.pluck("value"),this.model.set({value:b}),a.$results.empty(),this.select2.$container.off(),this.select2.destroy(),this.result.reset(),this.select2=null,c.__super__.reopen.apply(this,arguments)},c.prototype._checkIntValue=function(a){var b,c,d;if(null==a&&(a=[]),!a||!a.length)return!1;for(c=0,d=a.length;c<d;c++){if(b=a[c],null!=b.value&&_.isString(b.value))return!1;if(null!=b.id&&_.isString(b.id))return!1;if(null!=b&&_.isString(b))return!1}return!0},c.prototype._initSelect2=function(){var a;return null==this.select2&&(a=_.extend({},this.defaultModuleOpts,this.model.get("opts"),{multiple:this.model.get("multiple")||!1},this.forcedModuleOpts),this.$inp.select2(a),this.select2=this.$inp.data("select2"),this.model.get("multiple")||this.$inp.on("select2:select select2:close",this.select),this.select2._eventsAdded||(this.select2._eventsAdded=!0,this.select2.on("results:all",function(a){return function(b){var c,d,e;a.convertValueToInt=a._checkIntValue(null!=b&&null!=(c=b.data)?c.results:void 0),null!=(d=a.select2.selection)&&null!=(e=d.$search)&&"function"==typeof e.focus&&e.focus()}}(this)),this.select2.dataAdapter.current(function(a){return function(b){var c,d,e,f;if(a.model.get("waitForAsync")){for(c=[],d=0,e=b.length;d<e;d++)f=b[d],c.push(a._convertValue(f));a._select(c),a.close()}}}(this)),this.select2.$container.on("click",this._sel2open),this.select2.$element.hide(),this.select2.$selection.on("focusout",function(a){return function(b){a.TMfocusOut=setTimeout(function(){a.select()},150)}}(this)),this.select2.$selection.on("focusin",function(a){return function(b){null!=a.TMfocusOut&&clearTimeout(a.TMfocusOut)}}(this)))),this.select2},c.prototype._sel2open=function(a){return a.stopPropagation(),!1},c.prototype.remove=function(){return c.__super__.remove.apply(this,arguments)},c.prototype.getTemplateData=function(){var a,b,d,e,f,g,h,j,k,l,m;if(a=_.extend({},c.__super__.getTemplateData.apply(this,arguments),{multiple:this.model.get("multiple"),options:this._createOptionCollection(this.model.get("options"))}),null!=a.value&&_.isArray(a.value))for(l=a.value,d=g=0,j=l.length;g<j;d=++g)e=l[d],a.value[d]=this.convertValueToInt?parseFloat(e):e.toString();else null!=a.value&&(a.value=[this.convertValueToInt?parseFloat(a.value):a.value.toString()]);if(null!=a.value)for(f=_.pluck(a.options,"value"),m=a.value,h=0,k=m.length;h<k;h++)e=m[h],i.call(f,e)<0&&a.options.push({value:this.convertValueToInt?parseFloat(e):e.toString(),label:e,group:void 0});return b=_.groupBy(a.options,"group"),_.compact(_.keys(b||{})).length>1&&(a.optionGroups=b),a},c.prototype._hasTabListener=function(a){return!a&&this.model.get("multiple")},c.prototype._hasTabEvent=function(){return"keyup"},c.prototype.getValue=function(){var a,b,c,d,e,f;for(a=[],f=(null!=(e=this._initSelect2())?e.data():void 0)||[],c=0,d=f.length;c<d;c++)b=f[c],a.push(this._convertValue(b));return a},c.prototype._convertValue=function(a){var b;return b={},this.convertValueToInt?b.value=parseFloat(a.id):b.value=a.id,null!=a.text&&(a.text instanceof jQuery?b.label=a.text.html():b.label=a.text),b},c.prototype.getResults=function(){return{value:this.result.pluck("value")}},c.prototype._createOptionCollection=function(a){var b,c,d,e;if(_.isFunction(a))return a(this._createOptionCollection);for(b=[],c=0,d=a.length;c<d;c++)e=a[c],_.isString(e)||_.isNumber(e)?b.push({value:this.convertValueToInt?parseFloat(e):e.toString(),label:e,group:null}):_.isObject(e)&&(e.value=this.convertValueToInt?parseFloat(e.value):e.value.toString(),b.push(_.extend({},this.optDefault,e)));return b},c.prototype.unselect=function(a){var b,c;this.result.remove(null!=(b=a.params)&&null!=(c=b.data)?c.id:void 0)},c.prototype.close=function(){var a;this.model.get("waitForAsync")||(null!=this.select2&&this.select2.$container.hide(),null!=(a=this.$inp)&&a.remove(),this.$(".select-check").remove(),c.__super__.close.apply(this,arguments))},c.prototype.select=function(a){var b;return(null!=a?a.stopPropagation:void 0)&&a.stopPropagation(),b=this.getValue(),(null!=b?b.length:void 0)?(this._select(b),void this.close()):(this.close(),void(this.model.get("waitForAsync")||this.sub.del()))},c.prototype._select=function(a){var b,c,d,e;for(this.model.set("waitForAsync",!1),b=this.getSelectModel(),d=0,e=a.length;d<e;d++)c=a[d],this.result.add(new b(c));this.trigger("selected",this.result)},c}(a("./base")),b.exports=d},{"../../tmpls/select.jade":19,"../../utils/keycodes":25,"./base":26}],33:[function(a,b,c){var d,e=function(a,b){return function(){return a.apply(b,arguments)}},f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty;d=function(b){function c(){return this.focus=e(this.focus,this),this.reopen=e(this.reopen,this),this.close=e(this.close,this),this.events=e(this.events,this),c.__super__.constructor.apply(this,arguments)}return f(c,b),c.prototype.template=a("../../tmpls/string.jade"),c.prototype.events=function(){var a;return a={},a["keyup "+this._getInpSelector()]="input",a["keydown "+this._getInpSelector()]="input",a["blur "+this._getInpSelector()]="select",a},c.prototype.close=function(a){var b;c.__super__.close.apply(this,arguments);try{null!=(b=this.$inp)&&"function"==typeof b.remove&&b.remove()}catch(a){}},c.prototype.reopen=function(a){var b,d,e;b=null!=(d=this.result)&&null!=(e=d.first())?e.get("value"):void 0,this.model.set({value:b}),a.$results.empty().html(this.renderResult(!0)),c.__super__.reopen.apply(this,arguments)},c.prototype.focus=function(){c.__super__.focus.apply(this,arguments),this.$inp.select()},c}(a("./base")),b.exports=d},{"../../tmpls/string.jade":22,"./base":26}],34:[function(a,b,c){var d,e,f,g,h=function(a,b){return function(){return a.apply(b,arguments)}},i=function(a,b){function c(){this.constructor=a}for(var d in b)j.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},j={}.hasOwnProperty,k=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};g=a("./sub"),f=a("./selector"),d=a("../utils/keycodes"),e=function(b){function c(a){null==a&&(a={}),this._outerClick=h(this._outerClick,this),this._onFocusSearch=h(this._onFocusSearch,this),this.__onSearch=h(this.__onSearch,this),this.focusSearch=h(this.focusSearch,this),this._nextFacet=h(this._nextFacet,this),this._keyListen=h(this._keyListen,this),this._outerClickListen=h(this._outerClickListen,this),this._onClosed=h(this._onClosed,this),this._onOpened=h(this._onOpened,this),this.addFacet=h(this.addFacet,this),this.genSub=h(this.genSub,this),this.setFacet=h(this.setFacet,this),this.remFacet=h(this.remFacet,this),this.exit=h(this.exit,this),this._addFacet=h(this._addFacet,this),this.render=h(this.render,this),this.templateData=h(this.templateData,this),this.initialize=h(this.initialize,this),this.searchButton=null!=a?a.searchButton:void 0,this._onSearch=_.debounce(this.__onSearch,this.searchButton.debounce||300,{trailing:!1,leading:!0}),c.__super__.constructor.apply(this,arguments)}return i(c,b),c.prototype.template=a("../tmpls/wrapper.jade"),c.prototype.events={"mousedown .search-btn":"_onSearch","click .search-btn":"_onSearch","focus .search-btn":"_onFocusSearch","mousedown .add-facet-btn":"_addFacet",click:"_addFacet"},c.prototype.initialize=function(a){var b,c,d,e,f,g,h,i;for(this.main=a.main,this.idx=a.idx,this.results=a.results,this.facets={},this.collection.on("iggy:rem",this.remFacet),b="iggy clearfix",(null!=(h=this.el.className)?h.length:void 0)&&(b=" "+b),this.el.className+=b,this.render(),this._outerClickListen(),this._keyListen(),d=this.collection.filter(function(a){return null!=(null!=a?a.get("value"):void 0)||(null!=a?a.get("pinned"):void 0)}),c=function(a){return function(b,c){return b[a]>c[a]?1:b[a]<c[a]?-1:0}},i=d.sort(c("_idx")),f=0,g=i.length;f<g;f++)e=i[f],this.genSub(e,!1,!0);this.collection.on("add",function(a){return function(){a.$addBtn.show()}}(this)),setTimeout(function(a){return function(){var b,c;b=a.collection.filter(function(a){return(null!=a?a.get("active"):void 0)&&(null!=a?a.get("pinned"):void 0)}),b.length&&(c=a.facets[b[0].id],null!=c&&c.reopen(),null!=c&&c.focus())}}(this),0)},c.prototype.templateData=function(){var a;return a={tab_index:1e3*((this.idx||1)+1)-10},null!=this.searchButton&&(a.searchButton={template:this.searchButton.template||"",event:this.searchButton.event||"search",pullright:this.searchButton.pullright||!1,cssclass:this.searchButton.cssclass||"btn btn-primary fa fa-search"}),a},c.prototype.render=function(){var a;a=this.templateData(),this.$el.html(this.template(a)),this.$addBtn=this.$(".add-facet-btn"),null!=a.searchButton&&(this.$searchBtn=this.$(".search-btn"))},c.prototype._addFacet=function(a){this.TMopenAddFacet=setTimeout(function(a){return function(){a.addFacet()}}(this),0)},c.prototype.exit=function(a){return null==a&&(a=!0),this.subview?(this.subview.close(),this.subview=null,void(a&&this.addFacet())):void(this.selectview&&(this.selectview.close(),this.selectview=null))},c.prototype.remFacet=function(a){this.results.remove(a.get("name"))},c.prototype.setFacet=function(a,b){this.collection.remove(a),this.results.add(_.extend(b,{name:a.get("name"),type:a.get("type")}),{merge:!0,parse:!0,_facet:a}),this.collection.length||this.$addBtn.hide()},c.prototype.genSub=function(a,b,c){var d,e;return null==b&&(b=!0),null==c&&(c=!1),e=new g({model:a,collection:this.collection,parent:this}),e.on("closed",function(a){return function(c,d){var f;return(null!=e&&null!=(f=e.model)?f.get("pinned"):void 0)?void(a.subview=null):((null!=c?c.length:void 0)||e.remove(),a.subview=null,void(b&&"focusout"!==(null!=d?d.type:void 0)&&a.addFacet()))}}(this)),e.on("reopen",function(a){return function(){var b;null!=(b=a.selectview)&&b.close()}}(this)),d=this,e.on("selected",function(a,b,c){d.setFacet(a,b),null!=this.selectview._isFull&&!this.selectview._isFull()||"focusout"===(null!=c?c.type:void 0)||d._nextFacet(null,this)}),e.eventsAttached=!0,this.$addBtn.before(e.render(c)),this.facets[a.id]=e,e},c.prototype.addFacet=function(){return null!=this.selectview?void this.selectview.focus():(null!=this.subview&&this.subview.close(),void(this.collection.length&&(this.selectview=new f({collection:this.collection,custom:!1,main:this}),this.selectview.on("opened",function(a){return function(){a._onOpened()}}(this)),this.selectview.on("closed",function(a){return function(b){a._onClosed(),a.selectview.remove(),a.selectview=null,(null!=b?b.length:void 0)||null==a.subview||(a.subview.remove(),a.subview=null)}}(this)),this.selectview.on("selected",function(a){return function(b,c,d){b.set("value",null),a.subview=a.genSub(b),a.subview.open()}}(this)),this.$addBtn.before(this.selectview.render()),this.selectview.focus())))},c.prototype._onOpened=function(){var a;null!=(a=this.$addBtn)&&a.hide()},c.prototype._onClosed=function(){var a;null!=(a=this.$addBtn)&&a.show()},c.prototype._outerClickListen=function(){jQuery(document).on("click",this._outerClick)},c.prototype._keyListen=function(){jQuery(document).on("keydown",function(a){return function(b){var c,e,f,g,h,i,j;return b.keyCode===d.TAB||(e=b.keyCode,k.call(d.TAB,e)>=0)?$(b.target).is(".search-btn")&&(null!=b?b.shiftKey:void 0)?(null!=b&&b.preventDefault(),null!=b&&b.stopPropagation(),void(a.TMopenAddFacet=setTimeout(function(){return a.addFacet()},0))):(null!=(f=a.selectview)?f.isOpen:void 0)?(null!=b&&b.preventDefault(),null!=b&&b.stopPropagation(),void((null!=b?b.shiftKey:void 0)?(c=null!=(g=a.$addBtn)&&null!=(h=g.prevAll(".sub"))&&null!=(i=h.first())?i.data("fctid"):void 0,null!=c&&setTimeout(function(){var b;return null!=(b=a.facets[c])?b.reopen():void 0},0)):(a.selectview.close(),a.focusSearch()))):void a.trigger("escape",b,a._nextFacet):b.keyCode===d.ESC||(j=b.keyCode,k.call(d.ESC,j)>=0)?(a.exit(),void a.trigger("escape",b)):void 0}}(this))},c.prototype._nextFacet=function(a,b){var c,d,e,f;return d=(null!=a?a.shiftKey:void 0)?"prev":"next",c=null!=(f=b.$el)&&"function"==typeof f[d]?f[d]():void 0,c.hasClass("add-facet-btn")?(null!=a&&a.preventDefault(),null!=a&&a.stopPropagation(),void setTimeout(function(a){return function(){return a.addFacet()}}(this),0)):(e=null!=c?c.data("fctid"):void 0,void(null!=e&&(null!=a&&a.preventDefault(),setTimeout(function(a){return function(){var b;return null!=(b=a.facets[e])?b.reopen():void 0}}(this),0))))},c.prototype.focusSearch=function(){null!=this.$searchBtn&&this.$searchBtn.focus()},c.prototype.__onSearch=function(a){("click"===a.type&&0===a.clientX&&0===a.clientY||"mousedown"===a.type)&&(null!=a&&a.preventDefault(),a.stopPropagation(),this.exit(),this.trigger("searchbutton",this.searchButton.event))},c.prototype._onFocusSearch=function(a){var b;a.stopPropagation(),null!=(b=this.selectview)&&"function"==typeof b.close&&b.close()},c.prototype._outerClick=function(a){var b;null!=this.TMopenAddFacet&&clearTimeout(this.TMopenAddFacet),b=this.el.compareDocumentPosition(a.target),0===b||b-16>=0||this.exit(!1)},c}(Backbone.View),b.exports=e},{"../tmpls/wrapper.jade":24,"../utils/keycodes":25,"./selector":35,"./sub":36}],35:[function(a,b,c){var d,e,f=function(a,b){return function(){return a.apply(b,arguments)}},g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;d=a("../utils/keycodes"),e=function(b){function c(a){this.selectActive=f(this.selectActive,this),this.select=f(this.select,this),this.move=f(this.move,this),this.search=f(this.search,this),this.open=f(this.open,this),this.focus=f(this.focus,this),this.selected=f(this.selected,this),this._onTabAction=f(this._onTabAction,this),this._isFull=f(this._isFull,this),this._onClick=f(this._onClick,this),this.checkOptionsEmpty=f(this.checkOptionsEmpty,this),this.scrollHelper=f(this.scrollHelper,this),this._checkScroll=f(this._checkScroll,this),this.renderRes=f(this.renderRes,this),this.render=f(this.render,this),this.getTemplateData=f(this.getTemplateData,this),this.initialize=f(this.initialize,this),this.events=f(this.events,this),this.className=f(this.className,this),this.custom=a.custom||!1,this.activeIdx=0,this.currQuery="",null!=a.main&&(this.main=a.main),c.__super__.constructor.call(this,a)}return g(c,b),c.prototype.template=a("../tmpls/selector.jade"),c.prototype.templateEl=a("../tmpls/selectorli.jade"),c.prototype.selectCount=1,c.prototype.className=function(){var a;return a=["add-facet"],this.custom&&a.push("custom"),a.join(" ")},c.prototype.events=function(){var a;return a={"mousedown a":"_onClick"},a["focus input#"+this.cid]="open",a["keydown input#"+this.cid]="search",a["keyup input#"+this.cid]="search",a},c.prototype.initialize=function(a){c.__super__.initialize.apply(this,arguments),this.searchcoll=this.collection.sub(function(){return!0}),this.result=new this.collection.constructor,this.listenTo(this.searchcoll,"add",this.renderRes),this.listenTo(this.searchcoll,"remove",this.renderRes),this.listenTo(this.searchcoll,"remove",this.checkOptionsEmpty)},c.prototype.getTemplateData=function(){return _.extend(c.__super__.getTemplateData.apply(this,arguments),{custom:this.custom})},c.prototype.render=function(){return c.__super__.render.apply(this,arguments),this.$list=this.$el.find("#"+this.cid+"typelist"),this.renderRes(),this.el},c.prototype.renderRes=function(){var a,b,c,d,e,f,g,h,i,j,k;for(this.$list.empty(),d=[],j=this.searchcoll.models,g=f=0,h=j.length;f<h;g=++f)i=j[g],i.get("pinned")||(c=i.getLabel(),e=i.get("labeltemplate"),
null!=e&&(c=e.replace("{{label}}",c)),b=i.id,a=i.get("cssclass"),(null!=(k=this.currQuery)?k.length:void 0)>1&&(c=c.replace(new RegExp(this.currQuery,"gi"),function(a){return"<b>"+a+"</b>"})),d.push({label:c,id:b,cssclass:a}));return this.$list.append(this.templateEl({list:d,query:this.currQuery,activeIdx:this.activeIdx,custom:this.custom})),this._checkScroll(),this.$list},c.prototype._scrollTill=198,c.prototype._checkScroll=function(){var a;return a=this.$list.height(),a>0?void this.scrollHelper(a):void setTimeout(function(a){return function(){return a.scrollHelper(a.$list.height())}}(this),0)},c.prototype.scrollHelper=function(a){a>=this._scrollTill?this.scrolling=!0:this.scrolling=!1},c.prototype.checkOptionsEmpty=function(){},c.prototype._onClick=function(a){var b,c;if(a.stopPropagation(),a.preventDefault(),b=this.$(a.currentTarget).data("id"),null!=b&&(c=this.collection.get(b),null!=c))return this.selected(c),!1},c.prototype._isFull=function(){return!0},c.prototype._onTabAction=function(a){null!=this.main?(a.preventDefault(),a.stopPropagation(),this.main.focusSearch()):c.__super__._onTabAction.call(this,event)},c.prototype.selected=function(a){var b,c,d,e;null==this.main&&this._isFull()&&(d=null!=(e=this.result.last())?e.id:void 0,this.rmRes(d));try{if(null!=a.onlyExec)return void(null!=a&&"function"==typeof a.exec&&a.exec())}catch(a){b=a;try{console.error("Issue #23: CATCH - Class:"+this.constructor.name+" - activeIdx:"+this.activeIdx+" - collection:"+JSON.stringify(this.collection.toJSON()))}catch(a){c=a,console.error("Issue #23: CATCH")}}null!=a&&(this.searchcoll.remove(a),this.result.add(a),this.trigger("selected",a)),this._isFull()&&this.close()},c.prototype.focus=function(){var a;this.$inp.focus(),a=this.$inp.get(0),a.selectionStart=a.selectionEnd=a.value.length},c.prototype.open=function(){return this.trigger("opened"),c.__super__.open.apply(this,arguments)},c.prototype.search=function(a){var b;if("keydown"!==(null!=a?a.type:void 0))b=_.isString(a)?a:a.currentTarget.value.toLowerCase(),b!==this.currQuery&&(this.currQuery=b,this.searchcoll.updateSubFilter(function(a){return function(c){var d;return null==a.result.get(c.id)&&(null==b||!b.length||(d=c.match(b)))}}(this),!1),this.activeIdx=0,this.renderRes());else switch(a.keyCode){case d.UP:return void this.move(!0);case d.DOWN:return void this.move(!1);case d.ENTER:return void this.selectActive(!0)}},c.prototype.move=function(a){var b,c,d,e,f,g,h,i,j,k;if(null==a&&(a=!1),f=this.$el.find(".typelist a"),d=(null!=(k=this.currQuery)?k.length:void 0)?0:1,j=0,a){if(this.activeIdx-1<j)return;g=this.activeIdx-1}else{if(this.searchcoll.length-d<=this.activeIdx)return;g=this.activeIdx+1}this.$(f[this.activeIdx]).removeClass("active"),b=this.$(f[g]).addClass("active"),this.scrolling&&(e=b.outerHeight(),h=e*(g+1),c=this.$el.find(".typelist"),i=c.scrollTop(),h>i+this._scrollTill?c.scrollTop(h-this._scrollTill):h<i+e&&c.scrollTop(h-e)),this.activeIdx=g},c.prototype.select=function(){},c.prototype.selectActive=function(a){var b,c,d,e,f;if(null==a&&(a=!1),null==this.main&&this._isFull()&&(b=null!=(e=this.result.last())?e.id:void 0,this.rmRes(b)),d=this.$el.find(".typelist a.active").removeClass("active").data(),c=this.$inp.val(),null==d&&1!==this.selectCount&&a&&!(null!=c?c.length:void 0))return void this.close();if(null!=d)if(this.activeIdx=0,(null!=d?d.idx:void 0)>=0&&this.searchcoll.length)this.selected(this.collection.get(d.id));else{if(null==(f=this.currQuery)||!f.length)return;this.selected(new this.collection.model({value:this.currQuery,custom:!0})),this.$inp.val("")}},c}(a("./facets/base")),b.exports=e},{"../tmpls/selector.jade":20,"../tmpls/selectorli.jade":21,"../utils/keycodes":25,"./facets/base":26}],36:[function(a,b,c){var d,e=function(a,b){return function(){return a.apply(b,arguments)}},f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty;d=function(b){function c(){return this.open=e(this.open,this),this.isResultEmpty=e(this.isResultEmpty,this),this.attachSubEvents=e(this.attachSubEvents,this),this.generateSub=e(this.generateSub,this),this.close=e(this.close,this),this.focus=e(this.focus,this),this.isOpen=e(this.isOpen,this),this.renderResult=e(this.renderResult,this),this.removed=e(this.removed,this),this.selected=e(this.selected,this),this.remove=e(this.remove,this),this.del=e(this.del,this),this.reopen=e(this.reopen,this),this.render=e(this.render,this),this.initialize=e(this.initialize,this),this.className=e(this.className,this),c.__super__.constructor.apply(this,arguments)}return f(c,b),c.prototype.template=a("../tmpls/sub.jade"),c.prototype.className=function(){var a,b,c;return b="sub",c=this.model.get("type"),null!=c&&(b+=" sub-type-"+c),a=this.model.get("name"),null!=a&&(b+=" sub-name-"+a),b},c.prototype.initialize=function(a){this._isOpen=!1,this.result=new Backbone.Collection,this.parent=a.parent,this.$el.data("fctid",this.model.id),this.parent.on("escape",function(a){return function(b,c){var d;a._isOpen&&(null!=(d=a.selectview)?d._onTabAction(b):void 0)&&null!=c&&c(b,a)}}(this))},c.prototype.events={mousedown:"reopen","mousedown .rm-facet-btn":"del"},c.prototype.render=function(a){var b,c,d,e,f,g,h,i;for(d=[],i=this.result.models,f=e=0,g=i.length;e<g;f=++e){h=i[f];try{d.push(h.getLabel())}catch(a){b=a;try{console.error("Issue #24: CATCH - Class:"+this.constructor.name+" - model:"+JSON.stringify(this.model.toJSON())+" - result:"+JSON.stringify(this.result.toJSON()))}catch(a){c=a,console.error("Issue #24: CATCH")}}}return this.$el.html(this.template({label:this.model.getLabel(),selected:d,type:this.model.get("type"),name:this.model.get("name"),pinned:this.model.get("pinned")||!1})),this.$sub=this.$(".subselect"),this.$results=this.$(".subresults"),this.generateSub(a),this.el},c.prototype.reopen=function(a){var b,c;if(!this._isOpen){if(null!=a&&$(a.target).is(".rm-result-btn")&&null!=(null!=(b=this.selectview)?b.rmRes:void 0))return this.selectview.rmRes(a),a.preventDefault(),void a.stopPropagation();if(null!=a&&$(a.target).is(".edit-result-btn")&&null!=(null!=(c=this.selectview)?c.editRes:void 0))return this.selectview.editRes(a),a.preventDefault(),void a.stopPropagation();this._isOpen||null==this.selectview||this.selectview.reopen(this),null!=a&&a.preventDefault(),null!=a&&a.stopPropagation(),this.trigger("reopen")}},c.prototype.del=function(a){if(!this.model.get("pinned"))return null!=a&&a.stopPropagation(),null!=a&&a.preventDefault(),this.collection.trigger("iggy:rem",this.model),this.collection.add(this.model),this.remove(),this.trigger("closed"),!1},c.prototype.remove=function(){var a;return this._isOpen=!1,null!=(a=this.selectview)&&a.remove(),this.parent=null,c.__super__.remove.apply(this,arguments)},c.prototype.selected=function(a,b){this.result.add(a,{merge:!0}),this.renderResult(),this.trigger("selected",this.model,this.selectview.getResults(),b)},c.prototype.removed=function(a,b){this.result.remove(a),this.renderResult(),this.trigger("selected",this.model,this.selectview.getResults(),b),this.result.length<=0&&!this.selectview.editMode&&this.del()},c.prototype.renderResult=function(){this.$results.html(this.selectview.renderResult())},c.prototype.isOpen=function(){return null!=this.selectview},c.prototype.focus=function(){var a;return null!=this.selectview?void(null!=(a=this.selectview)&&a.focus()):void this.open()},c.prototype.close=function(){var a,b;if(this._isOpen=!1,null!=this.selectview)return null!=(a=this.selectview)&&a.off(),void(null!=(b=this.selectview)&&b.close())},c.prototype.generateSub=function(a){var b;return null!=this.selectview?(this.attachSubEvents(),this.selectview):(this.selectview=new this.model.SubView({sub:this,model:this.model,el:this.$sub}),this.attachSubEvents(),this.$el.append(this.selectview.render(a)),void(null!=(null!=(b=this.model)?b.get("value"):void 0)&&this.selectview.select()))},c.prototype.attachSubEvents=function(){this.selectview.subEventsAttached||(this.selectview.on("closed",function(a){return function(b,c){a._isOpen=!1,a.model.get("pinned")||(b.length||a.selectview.remove(),a.trigger("closed",b,c),b.length||a.remove())}}(this)),this.selectview.on("selected",function(a){return function(b,c){b&&a.selected(b,c)}}(this)),this.selectview.on("removed",function(a){return function(b){b&&a.removed(b)}}(this)),this.selectview.subEventsAttached=!0)},c.prototype.isResultEmpty=function(a){return null==this.selectview||this.selectview.isResultEmpty(a)},c.prototype.open=function(){var a;this.generateSub(),null!=(a=this.selectview)&&a.focus(),this._isOpen=!0},c}(Backbone.View),b.exports=d},{"../tmpls/sub.jade":23}],37:[function(a,b,c){},{}],38:[function(b,c,d){(function(e){!function(b){if("object"==typeof d&&"undefined"!=typeof c)c.exports=b();else if("function"==typeof a&&a.amd)a([],b);else{var f;f="undefined"!=typeof window?window:"undefined"!=typeof e?e:"undefined"!=typeof self?self:this,f.jade=b()}}(function(){return function a(c,d,e){function f(h,i){if(!d[h]){if(!c[h]){var j="function"==typeof b&&b;if(!i&&j)return j(h,!0);if(g)return g(h,!0);var k=new Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",k}var l=d[h]={exports:{}};c[h][0].call(l.exports,function(a){var b=c[h][1][a];return f(b?b:a)},l,l.exports,a,c,d,e)}return d[h].exports}for(var g="function"==typeof b&&b,h=0;h<e.length;h++)f(e[h]);return f}({1:[function(a,b,c){"use strict";function d(a){return null!=a&&""!==a}function e(a){return(Array.isArray(a)?a.map(e):a&&"object"==typeof a?Object.keys(a).filter(function(b){return a[b]}):[a]).filter(d).join(" ")}function f(a){return h[a]||a}function g(a){var b=String(a).replace(i,f);return b===""+a?a:b}c.merge=function a(b,c){if(1===arguments.length){for(var e=b[0],f=1;f<b.length;f++)e=a(e,b[f]);return e}var g=b.class,h=c.class;(g||h)&&(g=g||[],h=h||[],Array.isArray(g)||(g=[g]),Array.isArray(h)||(h=[h]),b.class=g.concat(h).filter(d));for(var i in c)"class"!=i&&(b[i]=c[i]);return b},c.joinClasses=e,c.cls=function(a,b){for(var d=[],f=0;f<a.length;f++)b&&b[f]?d.push(c.escape(e([a[f]]))):d.push(e(a[f]));var g=e(d);return g.length?' class="'+g+'"':""},c.style=function(a){return a&&"object"==typeof a?Object.keys(a).map(function(b){return b+":"+a[b]}).join(";"):a},c.attr=function(a,b,d,e){return"style"===a&&(b=c.style(b)),"boolean"==typeof b||null==b?b?" "+(e?a:a+'="'+a+'"'):"":0==a.indexOf("data")&&"string"!=typeof b?(JSON.stringify(b).indexOf("&")!==-1&&console.warn("Since Jade 2.0.0, ampersands (`&`) in data attributes will be escaped to `&amp;`"),b&&"function"==typeof b.toISOString&&console.warn("Jade will eliminate the double quotes around dates in ISO form after 2.0.0")," "+a+"='"+JSON.stringify(b).replace(/'/g,"&apos;")+"'"):d?(b&&"function"==typeof b.toISOString&&console.warn("Jade will stringify dates in ISO form after 2.0.0")," "+a+'="'+c.escape(b)+'"'):(b&&"function"==typeof b.toISOString&&console.warn("Jade will stringify dates in ISO form after 2.0.0")," "+a+'="'+b+'"')},c.attrs=function(a,b){var d=[],f=Object.keys(a);if(f.length)for(var g=0;g<f.length;++g){var h=f[g],i=a[h];"class"==h?(i=e(i))&&d.push(" "+h+'="'+i+'"'):d.push(c.attr(h,i,!1,b))}return d.join("")};var h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"},i=/[&<>"]/g;c.escape=g,c.rethrow=function b(c,d,e,f){if(!(c instanceof Error))throw c;if(!("undefined"==typeof window&&d||f))throw c.message+=" on line "+e,c;try{f=f||a("fs").readFileSync(d,"utf8")}catch(a){b(c,null,e)}var g=3,h=f.split("\n"),i=Math.max(e-g,0),j=Math.min(h.length,e+g),g=h.slice(i,j).map(function(a,b){var c=b+i+1;return(c==e?"  > ":"    ")+c+"| "+a}).join("\n");throw c.path=d,c.message=(d||"Jade")+":"+e+"\n"+g+"\n\n"+c.message,c},c.DebugItem=function(a,b){this.lineno=a,this.filename=b}},{fs:2}],2:[function(a,b,c){},{}]},{},[1])(1)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{fs:37}],39:[function(a,b,c){(function(){var a,c,d;d={}.toString,c=Array.isArray||function(a){return"[object Array]"===d.call(a)},a=function(a,b){return a[b]},b.exports=function(b,d,e){var f,g;return null==d&&(d=!0),null==e&&(e=a),c(b)||(b=[b]),(f=function(a,b,c){var d,g,h,i;return(null!=c?c.length:void 0)&&(g=null!=(i=c.splice(0,1))?i[0]:void 0,null!=g&&(h=f(a,g,c))),d=null!=a[b]?a[b]:null!=a["?"]?a["?"]:a,function(a,c){var f,g;return f=e(a,b),g=e(c,b),f<g?d?-1:1:f>g?d?1:-1:f===g?null!=h?h(a,c):0:void 0}})(d,null!=(g=b.splice(0,1))?g[0]:void 0,b)}}).call(this)},{}]},{},[1])(1)});